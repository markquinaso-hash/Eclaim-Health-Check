name: Python application

on:
  # Auto-run on pushes to main (adjust as needed)
  push:
    branches:
      - main
    # Optional: limit to file changes
    # paths:
    #   - 'send_test_email_with_screenshot.py'
    #   - '.github/workflows/gmail_smtp_inline_screenshot.yml'

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Show workspace files
        run: |
          pwd
          ls -la

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies (Playwright + dotenv)
        run: |
          python -m pip install --upgrade pip
          python -m pip install playwright python-dotenv
          python -m playwright install --with-deps chromium

      # No inputs anymore â€” just set defaults directly
      - name: Set default parameters
        run: |
          echo "SCREENSHOT_URL=https://docs.newrelic.com/docs/apis/nerdgraph/examples/nerdgraph-cloud-integrations-api-tutorial/#list-enabled-provider-accounts" >> $GITHUB_ENV
          echo "SUBJECT=Test Subject" >> $GITHUB_ENV
          echo "BODY=Test Body" >> $GITHUB_ENV

      - name: Run email with inline screenshot
        env:
          SMTP_USERNAME: ${{ secrets.SMTP_USERNAME }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
          SCREENSHOT_URL: ${{ env.SCREENSHOT_URL }}
          SUBJECT: ${{ env.SUBJECT }}
          BODY: ${{ env.BODY }}
          USE_SSL_465: "false"
        run: |
          python send_test_email_with_screenshot.py
